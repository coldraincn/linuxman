# shell编程

>shell是一个命令行解释器，为用户提供了一个向linux内核发送请求以便运行程序的界面系统级程序

## 基础

### 查看linux支持的shell

```shell
vim /etc/shells
```

### 执行方式

1. 直接运行

    ```shell
    chmod 755 test.sh
    ./test.sh
    ```

2. 使用bash调用

    ```shell
    bash test.sh
    ```

### echo输出命令

```shell
echo [选项] 输出内容
```

* -e 反斜杠转义

### 历史命令

>查看历史命令,历史命令默认保存1000条，可以修改/etc/profile

```shell
history [选项] [历史保存文件]
```

* -c 清空历史命令
* -w 把缓存中的历史命令写入到历史命令保存文件~/.bash_history

### 命令别名

```shell
alias 别名='原命令' # 设置别名
```

```shell
alias # 查询命令别名
```

```shell
vim /root/.bashrc #让别名永久生效
```

```shell
unalias 别名 # 删除别名
```

### 输出重定向

* `命令 > 文件`：以覆盖的方式，把命令的正确输出输出到指定的文件或设备中
* `命令 >>文件`：以追加的方式，。。。
* `错误命令 2> 文件`：以覆盖的方式，把命令的错误输出输出到指定的文件或设备
* `错误命令 2>> 文件`： 以追加的方式。。。。。
* `命令 > 文件 2>&1`或`命令 &> 文件`：以覆盖的方式，把正确输出和错误输出都保存到同一个文件当中
* `命令 >> 文件 2>&1`或 `命令 &>>文件`：以追加的方式，。。。
* `命令 >> 文件1 2>>文件2`：把正确的输出追加到文件1，错误的输出追加到文件2

### 输入重定向

* `命令 < 文件`:把文件作为命令的输入
* `命令 << 标识符...标识符`:把标识符之间的内容作为命令的输入

### 统计命令

```shell
wc [选项] [文件名]
```

* -c 统计字节数
* -w 统计单词数
* -l 统计行数

### 多命令顺序执行

|符号|格式|作用|
|:--:|:--:|:--:|
| ; |命令1 ; 命令2|多个命令顺序执行|
| && |命令1 && 命令2|逻辑与，当命令1正确执行，命令2才会执行，命令1执行不正确，命令2不会执行|
| || |命令1 || 命令2|逻辑或，当命令1正确执行，命令2不会执行；命令1执行不正确，命令2才会执行|

### 通配符

|通配符|作用|
|:--:|---|
| ? |匹配一个任意字符|
| * |匹配0个或任意多个任意字符|
| [] |匹配中括号中任意一个字符|
|[-]|匹配范围|
|[^]|匹配不是中括号内的一个字符|

### 其他符号

|符号|作用|
|:--:|---|
| '' |单引号，任何字符没有特殊含义|
| "" |双引号，类似\,$具有特殊意义|
| ``和$() |反引号，调用系统命令|
| $ |调用变量值|
| \ |转义|

### 变量特殊规则

* bash中变量的默认类型是字符串
* 变量用等号链接值，等号左右两侧不能有空格
* 变量值叠加，要用`"$变量名"`或者`${变量名}`
* 把命令的结果作为值赋予变量，要只用反引号或者$()来包含命令

### 变量查看

```shell
set
```

### 变量删除

```shell
unset name
```

### 环境变量

>用户自定义变量只在当前shell生效，环境变量会在当前shell以及子shell生效。如果写入配置文件，环境变量就会在所有的shell生效

### 设置环境变量

```shell
export 变量名=变量值
```

### 查询变量

```shell
env
```

### 删除环境变量

```shell
unset 变量名
```

### 位置参数变量

|位置参数变量|作用|
|:--:|---|
| $n |第n个参数,0代表命令本身|
| $* |把所有参数当成一个整体|
| $@ |代表命令行中所有参数，把每个参数区分对待|
| $# |参数的个数|

### 预定义变量

|预定义变量|作用|
|:--:|---|
| $? |最后一次执行的命令返回状态。如果变量值为0，证明上个命令正确执行，非0则执行不正确|
| $$ |当前进程的进程号|
| $! |后台运行的最后一个进程的进程号|

### 接收键盘输入

```shell
read [选项] 变量名
```

* -p "提示信息"：提示信息
* -t 秒数：等待输入时间
* -n 字符数：接收指定的字符数，就会执行
* -s ：隐藏输入数据

### 声明变量类型

```shell
declare [+\-] [选项] 变量名
```

* "-" :给变量设定类型属性
* "+" ：取消变量的类型属性
* "-i" :将变量声明为整数型
* "-x" ：将变量声明为环境变量
* "-p" :显示指定变量的被声明类型

### 数值运算

```shell
#方法1
[root@localhost ~]$ aa=11 
[root@localhost ~]$ bb=22 # 给变量 aa 和 bb 赋值
[root@localhost ~]$ declare -i cc=$aa+$bb
```

```shell
#方法2
[root@localhost ~]$ aa=11 
[root@localhost ~]$ bb=22 # 给变量 aa 和变量 bb 赋值
[root@localhost ~]$ dd=$(expr $aa + $bb) #dd 的值是 aa 和 bb 的和。注意“ + ”号左右两 侧必须有空格
```

```shell
#方法3
[root@localhost ~]$ aa=11
[root@localhost ~]$ bb=22
[root@localhost ~]$ ff=$(( $aa+$bb ))
[root@localhost ~]$ gg=$[ $aa+$bb ]
```

### 配置文件生效(待补充)

```shell
source 配置文件
```

## shell编程进阶

### 正则(待补充)

```shell
grep [选项] "搜索内容" 文件名
```

* -i :忽略大小写
* -n ：输出行号
* -v :反向查找
* --color=auto :搜索处的关键字用言责显示

### cut

>字段提取，根据tab或者指定分隔符

```shell
cut [选项] 文件名
```

* -f 列号:提取第几列
* -d 分隔符：按照指定的分隔符分割列

### awk

```shell
awk '条件1{动作1} 条件2{动作2}.。。' 文件名
```

### sed

>用来将数据进行选取，替换，删除，新增的命令

```shell
sed [选项] '[动作]' 文件名
```

选项：  

* -n :指挥把经过sed处理的行输出到屏幕
* -e ：允许对输入数据应用多条sed命令编辑
* -i ：用sed修改的结果直接应用到文件

### 排序命令

```shell
sort [选项] 文件名
```

* -f :忽略大小写
* -n ：以数值型进行排序，默认字符串类型
* -r ：反向排序
* -t ：指定分隔符
* -k n[,m] :从第n字段开始，m字段结束排序

### 条件判断（待补充）

### if语句

```shell
if [ 条件判断 ]
    then
        执行语句
    else
        执行语句
fi
```

### case语句

```shell
case $变量名 in
    "值1")
        执行语句
        ;;
    "值2")
        执行语句
        ;;
    ...
    *)
        执行语句
        ;;
esac
```

### while语句

```shell
while [ 条件判断 ]
    do
        执行语句
    done
```

